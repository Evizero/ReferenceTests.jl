<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · ReferenceTests.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link href="assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>ReferenceTests.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li class="current"><a class="toctext" href>Home</a><ul class="internal"><li><a class="toctext" href="#Contents-1">Contents</a></li><li><a class="toctext" href="#Index-1">Index</a></li><li><a class="toctext" href="#Public-Interface-1">Public Interface</a></li></ul></li></ul></nav><article id="docs"><header><nav><ul><li><a href>Home</a></li></ul><a class="edit-page" href="https://github.com/Evizero/ReferenceTests.jl/blob/master/docs/src/index.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>Home</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="ReferenceTests.jl-Documentation-1" href="#ReferenceTests.jl-Documentation-1">ReferenceTests.jl Documentation</a></h1><p>ReferenceTests.jl is a Julia package that adds a couple of additional macros to your testing toolbox. In particular, it focuses on functionality for testing values against reference files, which in turn the package can help create and update if need be. ReferenceTests.jl is build on top of <a href="https://github.com/JuliaIO/FileIO.jl"><code>FileIO.jl</code></a> and designed to be used alongside <code>Base.Test</code>.</p><h2><a class="nav-anchor" id="Contents-1" href="#Contents-1">Contents</a></h2><ul><li><a href="#ReferenceTests.jl-Documentation-1">ReferenceTests.jl Documentation</a></li><ul><li><a href="#Contents-1">Contents</a></li><li><a href="#Index-1">Index</a></li><li><a href="#Public-Interface-1">Public Interface</a></li></ul></ul><h2><a class="nav-anchor" id="Index-1" href="#Index-1">Index</a></h2><ul><li><a href="#ReferenceTests.@io2str"><code>ReferenceTests.@io2str</code></a></li><li><a href="#ReferenceTests.@test_reference"><code>ReferenceTests.@test_reference</code></a></li><li><a href="#ReferenceTests.@withcolor"><code>ReferenceTests.@withcolor</code></a></li></ul><h2><a class="nav-anchor" id="Public-Interface-1" href="#Public-Interface-1">Public Interface</a></h2><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="ReferenceTests.@withcolor" href="#ReferenceTests.@withcolor"><code>ReferenceTests.@withcolor</code></a> — <span class="docstring-category">Macro</span>.</div><div><div><pre><code class="language-none">@withcolor ex</code></pre><p>Make sure that <code>ex</code> is evaluated while <code>Base.have_color</code> is set to <code>true</code>. The original value of <code>Base.have_color</code> will be restored afterwards.</p><p>This macro is particularily useful for CI, where it is not unusual that  <code>julia</code> is executed without the <code>--color=yes</code> argument by default.</p><pre><code class="language-julia">@withcolor print_with_color(:green, &quot;foo&quot;)</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/Evizero/ReferenceTests.jl/blob/320e35657aec8030e5e7b26171c055e2e8e57ebf/src/utils.jl#L62-L76">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="ReferenceTests.@io2str" href="#ReferenceTests.@io2str"><code>ReferenceTests.@io2str</code></a> — <span class="docstring-category">Macro</span>.</div><div><div><pre><code class="language-none">@io2str ex</code></pre><p>Search and replace the placeholder <code>::IO</code> with a newly allocated <code>Base.IOBuffer</code> which is afterwards converted to a string and returned.</p><p>This macro allows a user to conveniently test text-based printing functionality that require an <code>IO</code> argument. A particularly common example of such would be a custom <code>Base.show</code> method.</p><p><strong>Examples</strong></p><pre><code class="language-julia-repl">julia&gt; using ReferenceTests

julia&gt; @io2str print(::IO, &quot;Hello World&quot;)
&quot;Hello World&quot;

julia&gt; @io2str show(IOContext(::IO, :limit=&gt;true, :displaysize=&gt;(10,10)), &quot;text/plain&quot;, ones(10))
&quot;10-element Array{Float64,1}:\n 1.0\n 1.0\n 1.0\n ⋮  \n 1.0\n 1.0&quot;</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/Evizero/ReferenceTests.jl/blob/320e35657aec8030e5e7b26171c055e2e8e57ebf/src/utils.jl#L1-L23">source</a></section><section class="docstring"><div class="docstring-header"><a class="docstring-binding" id="ReferenceTests.@test_reference" href="#ReferenceTests.@test_reference"><code>ReferenceTests.@test_reference</code></a> — <span class="docstring-category">Macro</span>.</div><div><div><pre><code class="language-none">@test_reference filename expr [by] [kw...]</code></pre><p>Tests that the expression <code>expr</code> with reference <code>filename</code> using equality test strategy <code>by</code>.</p><p>The pipeline of <code>test_reference</code> is:</p><ol><li>preprocess <code>expr</code></li><li>read and preprocess <code>filename</code></li><li>compare the results using <code>by</code></li><li>if test fails in an interactive session (e.g, <code>include(test/runtests.jl)</code>), an interactive dialog will be trigered.</li></ol><p>Arguments:</p><ul><li><code>filename::String</code>: <em>relative</em> path to the file that contains the macro invocation.</li><li><code>expr</code>: the actual content used to compare.</li><li><code>by</code>: the equality test function. By default it is <code>isequal</code> if not explicitly stated.</li></ul><p><strong>Types</strong></p><p>The file-extension of <code>filename</code>, as well as the type of the result of evaluating <code>expr</code>, determine how contents are processed and compared. The contents is treated as:</p><ul><li>Images when <code>expr</code> is an image type, i.e., <code>AbstractArray{&lt;:Colorant}</code>;</li><li>SHA256 when <code>filename</code> endswith <code>*.sha256</code>;</li><li>Text as a fallback.</li></ul><p><strong>Images</strong></p><p>Images are compared <em>approximately</em> using a different <code>by</code> to ignore most encoding and decoding errors. The default value is <code>Images.@test_approx_eq_sigma_eps</code>.</p><p>The file can be either common image files (e.g., <code>*.png</code>), which are handled by <code>FileIO</code>, or text-coded <code>*.txt</code> files, which is handled by <code>ImageInTerminal</code>. Text-coded image has less storage requirements and also allows to view the reference file in a simple terminal using <code>cat</code>.</p><p><strong>SHA256</strong></p><p>The hash of the <code>expr</code> and content of <code>filename</code> are compared.</p><div class="admonition tip"><div class="admonition-title">Tip</div><div class="admonition-text"><p>This is useful for a convenient low-storage way of making sure that the return value doesn&#39;t change for selected test cases.</p></div></div><p><strong>Fallback</strong></p><p>Simply test the equality of <code>expr</code> and the contents of <code>filename</code> without any preprocessing.</p><p><strong>Examples</strong></p><pre><code class="language-julia"># store as string using ImageInTerminal with encoding size (5,10)
@test_reference &quot;camera.txt&quot; testimage(&quot;cameraman&quot;) size=(5,10)

# using folders in the relative path is allowed
@test_reference &quot;references/camera.png&quot; testimage(&quot;cameraman&quot;)

# Images can also be stored as hash. Note however that this
# can only check for equality (no tolerance possible)
@test_reference &quot;references/camera.sha256&quot; testimage(&quot;cameraman&quot;)

# test images using ImageQualityIndexes.PSNR
@test_reference &quot;references/camera.png&quot; testimage(&quot;cameraman&quot;) by=(x,y)-&gt;psnr(x,y)&gt;25

# test number with absolute tolerance 10
@test_reference &quot;references/string3.txt&quot; 1338 by=(ref, x)-&gt;isapprox(ref, x; atol=10)</code></pre></div></div><a class="source-link" target="_blank" href="https://github.com/Evizero/ReferenceTests.jl/blob/320e35657aec8030e5e7b26171c055e2e8e57ebf/src/test_reference.jl#L1-L74">source</a></section><footer><hr/></footer></article></body></html>
